#!/bin/bash

# Script to check that mplayer is still running
# If not restarts whole piece

lasttrack=""
currenttrack=""

while :
do
	PID=$(ps -ef | grep 'mplayer -slave' | grep -v grep | awk '{print $2}')
	until [[ -z $PID ]]
	do
		sleep 10
		# Check mplayer is still alive
		PID=$(ps -ef | grep 'mplayer -slave' | grep -v grep | awk '{print $2}')
		# Check if track has changed and inform PiMplayer
		#if [[ "$lasttrack" == "$currenttrack" ]]
		#then
			#currenttrack=$(./getinfo)
		#fi
		#if [[ "$lasttrack" != "$currenttrack" ]]
		#then
			# Alert PiMplayer
			#lasttrack="$currenttrack"
			#echo "Alert PiMplayer to change display"
			#kill -USR1 $PID
		#fi
	done
	pkill PiMplayer
	pkill mplayer-slave
	nohup ./mplayer-slave $1 &
done
